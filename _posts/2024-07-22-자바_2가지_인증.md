---
title: Java Spring OpenAPI ì ìš©
date: YYYY-MM-DD HH:MM:SS +09:00
categories: [Java, ê°œë°œ]
tags:
  [
    java,
    swagger,
    spring,
    springdoc
  ]
---

# API ì„œë²„ ë‚´ Swagger ì ìš©

## ìš”êµ¬ ì‚¬í•­

- ì„œë²„ ë‚´ Swagger ë„ì…
- 2 ê°€ì§€ì˜  Bearer í† í° ì¸ì¦ ë°©ì‹
    1. SSOì¸ì¦ í† í°
    2. JWTí† í°

## ì‘ì—… í™˜ê²½

```jsx
JDK: 11
Framework: Spring
Spring Boot Version: 2.6.6
Build: Gradle
```

## ì´ˆê¸° ì„¤ì •

### íŒ¨í‚¤ì§€ ì¶”ê°€

```groovy
  // swagger (JDK 11 ê¸°ì¤€ ì§€ì› ë²„ì „ ì¤‘ Latest)
	implementation("org.springdoc:springdoc-openapi-ui:1.7.0")
```

### í™˜ê²½ ì„¤ì •

```yaml
springdoc:
  default-consumes-media-type: application/json;charset=UTF-8 # ìš”ì²­ì‹œ ì „ë‹¬ë°›ì„ Media Type
  default-produces-media-type: application/json;charset=UTF-8 # ì‘ë‹µì‹œ ì „ë‹¬í•  Media Type
  swagger-ui:
    path: /swagger  # Custom Path
    disable-swagger-default-url: true # default urlì„ ì‚¬ìš©í•˜ì§€ ì•ŠìŒ
    display-request-duration: true # ìš”ì²­ ì²˜ë¦¬ ì‹œê°„ í‘œì‹œ
    operations-sorter: alpha  # enpoint ì •ë ¬ ê¸°ì¤€ , alpha: ì•ŒíŒŒë²³ ìˆœ, method: ë©”ì†Œë“œìˆœ
    syntaxHighlight:
      activated: false # ì‘ë‹µ ë°ì´í„°ê°€ í´ ê²½ìš° ëŒ€ì²˜í•˜ëŠ” ë°©ë²• ì¤‘ í•˜ë‚˜
  paths-to-match: /api/v1/**. # ìŠ¤ìº”í•  package ê²½ë¡œ
  url: http://localhost:8080  # server url < custom field

```

## ì½”ë“œ ì‘ì„±

## Config ì‘ì„±

- ì–´ë…¸í…Œì´ì…˜ìœ¼ë¡œ í•  ìˆ˜ ìˆëŠ” ë°©ë²•ë„ ìˆìœ¼ë‚˜, Bean ë“±ë¡ì„ ì´ìš©í•œ Config ì„¤ì • ì´ìš©

```java
@Configuration
public class SwaggerConfig {
    @Value("${springdoc.url}")
    private String url;

    // ë³´ì•ˆ ìŠ¤í‚¤ë§ˆì—ì„œ ì‚¬ìš©í•  ì´ë¦„ (Controller ì—ì„œë„ ì‚¬ìš©í•˜ê³  ì‹¶ì–´ì„œ Static ë“±ë¡)
    public static final String jwtSchemaName = "JWT Authentication (Bearer ë¶™ì—¬ì£¼ì„¸ìš”)";
    public static final String integrateAuthJwtSchemaName = "Integrate Auth Authentication (Bearer ë¶™ì—¬ì£¼ì„¸ìš”)";

    @Bean
    public OpenAPI openAPI() {
        return new OpenAPI()
                .components(
                        new Components() // ì»´í¬ë„ŒíŠ¸ ë“±ë¡ ë° ë³´ì•ˆ ìŠ¤í‚¤ë§ˆ ë“±ë¡
                                .addSecuritySchemes(integrateAuthJwtSchemaName, createIntegrateAuthSecurityScheme())
                                .addSecuritySchemes(jwtSchemaName , createJwtSecurityScheme())
                )
                .info(apiInfo()) // ì¸í¬ ë“±ë¡
                .servers( // ì„œë²„ ë“±ë¡
                        List.of(new Server().url(url).description("Carrot API Documentation")
                        )
                ) // ë³´ì•ˆ ìš”êµ¬ì‚¬í•­ ë“±ë¡
                .addSecurityItem(new SecurityRequirement().addList(integrateAuthJwtSchemaName))
                .addSecurityItem(new SecurityRequirement().addList(jwtSchemaName));
    }
    
    // ì¸í¬ ë“±ë¡ í•¨ìˆ˜
    private Info apiInfo() {
        return new Info()
                .title("Carrot API")
                .description("Carrot API")
                .version("1.0.0");
    }

    // SSOí† í° ë³´ì•ˆ ìŠ¤í‚¤ë§ˆ ë“±ë¡ í•¨ìˆ˜
    private SecurityScheme createIntegrateAuthSecurityScheme() {
        return new SecurityScheme()
                .name("Authorization")
                .in(SecurityScheme.In.HEADER)
                .type(SecurityScheme.Type.APIKEY)
                .description("Authorization Header")
//                .type(SecurityScheme.Type.HTTP)
//                .scheme("bearer")
//                .bearerFormat("JWT");
    }

    // JWTí† í° ë³´ì•ˆ ìŠ¤í‚¤ë§ˆ ë“±ë¡ í•¨ìˆ˜
    private SecurityScheme createJwtSecurityScheme() {
        return new SecurityScheme()
                .name("X-Authorization")
                .in(SecurityScheme.In.HEADER)
                .type(SecurityScheme.Type.APIKEY)
                .description("X-Authorization Header")
    }
}

```

- Component ìƒì„±ì‹œì—ëŠ” ë³´ì•ˆ ìŠ¤í‚¤ë§ˆë¥¼ ë“±ë¡

<aside>
ğŸ’¡ ë³´ì•ˆ ìŠ¤í‚¤ë§ˆì™€ ë³´ì•ˆ ìš”êµ¬ ì‚¬í•­ì˜ ì°¨ì´ì 
ë³´ì•ˆ ìŠ¤í‚¤ë§ˆ: ë³´ì•ˆ ìŠ¤í‚¤ë§ˆëŠ” OpenAPI ë¬¸ì„œì—ì„œ ì‹¤ì œë¡œ ì‚¬ìš©ë˜ëŠ” ë³´ì•ˆ ë°©ì‹ì„ ì •ì˜
ë³´ì•ˆ ìš”êµ¬ ì‚¬í•­: ë³´ì•ˆ ìš”êµ¬ ì‚¬í•­ì€ ì‹¤ì œë¡œ APIì˜ íŠ¹ì • ê²½ë¡œë‚˜ ì—°ì‚°ì— ì ìš©ë˜ëŠ” ë³´ì•ˆ ìŠ¤í‚¤ë§ˆë¥¼ ì§€ì •

</aside>

### Controller ì½”ë“œ

- Tag ë¡œ endpoint ë³„ ì„¤ëª…ì„ ì‘ì„±í•œë‹¤.
- Operation ë“±ë¡ ì‹œ, ê° endpoint ë³„ ë‹¤ë¥´ê²Œ ê°€ì ¸ê°ˆ ë³´ì•ˆ ìš”êµ¬ ì‚¬í•­ì„ ì •ì˜ í•œë‹¤.

1. SSOController

```java
// SSOController
@Tag(name = "SSO ì¸ì¦ìš© í…ŒìŠ¤íŠ¸ api")
@RestController
@RequestMapping("/api/v1/sso")
@RequiredArgsConstructor
@Slf4j
public class SsoController {

    @Operation(summary = "ssoë¥¼ í†µí•œ ì¸ì¦ ì¡°íšŒ í…ŒìŠ¤íŠ¸", security = @SecurityRequirement(name = (SwaggerConfig.integrateAuthJwtSchemaName)))
    @RequestMapping(method = RequestMethod.GET, produces = "application/json;charset=UTF8")
    public String get(
            HttpServletRequest request
    ) {
        // ì‹¤ì œ ë‚´ë¶€ ë¡œì§
    }
}
```

1. JWT Controller

```java
@Tag(name = "JWT í† í°ìš© í…ŒìŠ¤íŠ¸ api")
@RestController
@RequestMapping("/api/v1/jwt")
@RequiredArgsConstructor
@Slf4j
public class JwtController {

    @Operation(summary = "sjwtë¥¼ í†µí•œ ì¡°íšŒ í…ŒìŠ¤íŠ¸", security = @SecurityRequirement(name = (SwaggerConfig.jwtSchemaName)))
    @RequestMapping(method = RequestMethod.GET,  produces = "application/json;charset=UTF8")
    public String get(
            HttpServletRequest request
    ) {
        // ì‹¤ì œ ë¡œì§
    }
}
```

### swagger ì‘ë‹µ ì‚¬ì´ì¦ˆê°€ ì»¤ì„œ Hanging ê±¸ë¦´ ë•Œ ëŒ€ì²˜ ë²•

- swagger ì—ì„œ ì˜ˆì „ë¶€í„° ì§€ì†ì ìœ¼ë¡œ ë¬¸ì œ ëë˜ í° ì‚¬ì´ì¦ˆì˜ ì‘ë‹µ ë°ì´í„° ì „ë‹¬ ì‹œ hangingì´ ê±¸ë¦¬ë©° ì‘ë‹µ ëŒ€ê¸°ê°€ ê±¸ë¦¬ë˜ ë¬¸ì œëŠ” ë‹¤ìŒê³¼ ê°™ì€ ë°©ë²•ìœ¼ë¡œ í•´ê²°í•´ë³¼ ìˆ˜ ìˆë‹¤ (ì •ë‹µì€ ì•„ë‹˜)
- [application.properties](http://application.properties) ì„¤ì • ë‚´ ë‹¤ìŒ ì„¤ì • ì¶”ê°€

```java
springdoc:
  swagger-ui:
    syntaxHighlight:
      activated: false
```

- â€˜Bearer â€˜ì„ ë¶™ì—¬ì•¼ í•˜ëŠ” ì´ìœ 
    - ì•„ë˜ ì²˜ëŸ¼ ë³´ì•ˆ ìŠ¤í‚¤ë§ˆ íƒ€ì…ì´ HTTPì¸ ê²½ìš°ì—ëŠ” schemaì™€ bearerFormatì„ ì„¤ì •í•  ìˆ˜ ìˆì§€ë§Œ
    - í˜„ì¬ ì»¤ìŠ¤í…€í•œ í† í° í—¤ë”ë¥¼ ë„£ì–´ì•¼í•˜ëŠ” ìƒí™©ì—ì„œ (ìŠ¤í‚¤ë§ˆë¥¼ ë”°ë¡œ ì •ì˜í•´ì„œ Authorization í—¤ë”ë¥¼ ì“°ëŠ” ë¶€ë¶„ì€ HTTP íƒ€ì…ìœ¼ë¡œ í•  ìˆ˜ ìˆì§€ë§Œ í†µì¼ì„±ì„ ìœ„í•´ì„œ) íƒ€ì…ì„ APIKEYë¡œ ì§€ì •í•´ì¤˜ì•¼í–ˆê¸° ë•Œë¬¸ì—
    Bearer  ì„ ì§ì ‘ ë¶™ì—¬ì¤˜ì•¼ í–ˆë‹¤.

```java
//                .type(SecurityScheme.Type.HTTP)
//                .scheme("bearer")
//                .bearerFormat("JWT");

```
